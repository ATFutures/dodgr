<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>dodgr • dodgr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="dodgr">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">dodgr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.5.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">Home</a>
</li>
<li>
  <a href="../articles/index.html">Vignettes</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ATFutures/dodgr">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>dodgr</h1>
                        <h4 class="author">Mark Padgham</h4>
            
            <h4 class="date">2019-10-15</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ATFutures/dodgr/blob/master/vignettes/dodgr.Rmd"><code>vignettes/dodgr.Rmd</code></a></small>
      <div class="hidden name"><code>dodgr.Rmd</code></div>

    </div>

    
    
<div id="background-directed-graphs" class="section level1">
<h1 class="hasAnchor">
<a href="#background-directed-graphs" class="anchor"></a>1 Background: Directed Graphs</h1>
<p><code>dodgr</code> is an <strong>R</strong> package for calculating <strong>D</strong>istances <strong>O</strong>n <strong>D</strong>irected <strong>Gr</strong>aphs. It does so very efficiently, and is able to process larger graphs than many other comparable <strong>R</strong> packages. Skip straight to the Intro if you know what directed graphs are (but maybe make a brief stop-in to Dual-Weighted Directed Graphs below.) Directed graphs are ones in which the “distance” (or some equivalent measure) from A to B is not necessarily equal to that from B to A. In Fig. 1, for example, the weights between the graph vertices (A, B, C, and D) differ depending on the direction of travel, and it is only possible to traverse the entire graph in an anti-clockwise direction.</p>
<p><img src="fig1.png"></p>
<p>Graphs in <code>dodgr</code> are represented by simple flat <code>data.frame</code> objects, so the graph of Fig. 1, presuming the edge weights to take values of 1, 2, and 3, would be,</p>
<pre><code>##   from to d
## 1    A  B 1
## 2    B  A 2
## 3    B  C 1
## 4    B  D 3
## 5    C  B 2
## 6    C  D 1
## 7    D  C 2
## 8    D  A 1</code></pre>
<p>The primary function of <code>dodgr</code> is <code>dodgr_dists</code>, which calculates pair-wise shortest distances between all vertices of a graph.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw"><a href="../reference/dodgr_dists.html">dodgr_dists</a></span> (graph)</a></code></pre></div>
<pre><code>##   A B C D
## A 0 1 2 3
## B 2 0 1 2
## C 2 2 0 1
## D 1 2 2 0</code></pre>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw"><a href="../reference/dodgr_dists.html">dodgr_dists</a></span> (graph, <span class="dt">from =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span> (<span class="st">"A"</span>, <span class="st">"C"</span>), <span class="dt">to =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span> (<span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"D"</span>))</a></code></pre></div>
<pre><code>##   B C D
## A 1 2 3
## C 2 0 1</code></pre>
<div id="dual-weighted-directed-graphs" class="section level2">
<h2 class="hasAnchor">
<a href="#dual-weighted-directed-graphs" class="anchor"></a>1.1 Dual-Weighted Directed Graphs</h2>
<p>Shortest-path distances on weighted graphs can be calculated using a number of other <strong>R</strong> packages, such as <a href="https://cran.r-project.org/package=igraph"><code>igraph</code></a> or <a href="https://cran.r-project.org/package=e1071"><code>e1071</code></a>. <code>dodgr</code> comes into its own through its ability to trace paths through <em>dual-weighted</em> directed graphs, illustrated in Fig. 2.</p>
<p><img src="fig2.png"></p>
<p>Dual-weighted directed graphs are common in many areas, a foremost example being routing through street networks. Routes through street networks depends on mode of transport: the route a pedestrian might take will generally differ markedly from the route the same person might take if behind the wheel of an automobile. Routing through street networks thus generally requires each edge to be specified with two weights or distances: one quantifying the physical distance, and a second weighted version reflecting the mode of transport (or some other preferential weighting).</p>
<p><code>dodgr</code> calculates shortest paths using one set of weights (called “weights” or anything else starting with “w”), but returns the actual lengths of them using a second set of weights (called “distances”, or anything else starting with “d”). If no weights are specified, distances alone are used both for routing and final distance calculations. Consider that the weights and distances of Fig. 2 are the black and grey lines, respectively, with the latter all equal to one. In this case, the graph and associated shortest distances are,</p>
<pre><code>##   from to w d
## 1    A  B 1 1
## 2    B  A 2 1
## 3    B  C 1 1
## 4    B  D 3 1
## 5    C  B 2 1
## 6    C  D 1 1
## 7    D  C 2 1
## 8    D  A 1 1</code></pre>
<pre><code>##   A B C D
## A 0 1 2 2
## B 1 0 1 1
## C 2 1 0 1
## D 1 2 1 0</code></pre>
<p>Note that even though the shortest “distance” from A to D is actually A<span class="math inline">\(\to\)</span>B<span class="math inline">\(\to\)</span>D with a distance of only 2, that path has a weighted distance of 1 + 3 = 4. The shortest <em>weighted</em> path is A<span class="math inline">\(\to\)</span>B<span class="math inline">\(\to\)</span>C<span class="math inline">\(\to\)</span>D, with a distance both weighted and unweighted of 1 + 1 + 1 = 3. Thus <code>d(A,D) = 3</code> and not 2.</p>
</div>
</div>
<div id="introduction-to-dodgr" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction-to-dodgr" class="anchor"></a>2 Introduction to <code>dodgr</code>
</h1>
<p>Although the package has been intentionally developed to be adaptable to any kinds of networks, most of the applications illustrated here concern street networks, and also illustrate several helper functions the package offers for working with street networks. The basic <code>graph</code> object of <code>dodgr</code> is nevertheless arbitrary, and need only minimally contain three or four columns as demonstrated in the simple examples at the outset.</p>
<p>The package may be used to calculate a matrix of distances between a given set of geographic coordinates. We can start by simply generating some random coordinates, in this case within the bounding box defining the city of York in the U.K.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">bb &lt;-<span class="st"> </span>osmdata<span class="op">::</span><span class="kw"><a href="https://docs.ropensci.org/osmdata/reference/getbb.html">getbb</a></span> (<span class="st">"york uk"</span>)</a>
<a class="sourceLine" id="cb8-2" data-line-number="2">npts &lt;-<span class="st"> </span><span class="dv">1000</span></a>
<a class="sourceLine" id="cb8-3" data-line-number="3">xy &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/apply.html">apply</a></span> (bb, <span class="dv">1</span>, <span class="cf">function</span> (i) <span class="kw"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span> (i) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span> (npts) <span class="op">*</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/diff.html">diff</a></span> (i))</a>
<a class="sourceLine" id="cb8-4" data-line-number="4">bb; <span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span> (xy)</a></code></pre></div>
<pre><code>##         min        max
## x -1.241536 -0.9215361
## y 53.799056 54.1190555</code></pre>
<pre><code>##               x        y
## [1,] -1.1713502 53.89409
## [2,] -1.2216108 54.01065
## [3,] -1.0457199 53.83613
## [4,] -0.9384666 53.93545
## [5,] -0.9445541 53.89436
## [6,] -1.1207099 54.01262</code></pre>
<p>The following lines download the street network within that bounding box, weight it for pedestrian travel, and use the weighted network to calculate the pairwise distances between all of the <code>xy</code>points.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">net &lt;-<span class="st"> </span><span class="kw"><a href="../reference/dodgr_streetnet.html">dodgr_streetnet</a></span> (bb)</a>
<a class="sourceLine" id="cb11-2" data-line-number="2">net &lt;-<span class="st"> </span><span class="kw"><a href="../reference/weight_streetnet.html">weight_streetnet</a></span> (net, <span class="dt">wt_profile =</span> <span class="st">"foot"</span>)</a>
<a class="sourceLine" id="cb11-3" data-line-number="3"><span class="kw"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span> (</a>
<a class="sourceLine" id="cb11-4" data-line-number="4">            d &lt;-<span class="st"> </span><span class="kw"><a href="../reference/dodgr_dists.html">dodgr_dists</a></span> (net, <span class="dt">from =</span> xy, <span class="dt">to =</span> xy)</a>
<a class="sourceLine" id="cb11-5" data-line-number="5">            )</a></code></pre></div>
<pre><code>##    user  system elapsed 
##  38.828   0.036   5.424</code></pre>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/dim.html">dim</a></span> (d); <span class="kw"><a href="https://rdrr.io/r/base/range.html">range</a></span> (d, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## [1] 1000 1000</code></pre>
<pre><code>## [1]     0.00 57021.18</code></pre>
<p>The result is a matrix of 1000-by-1000 distances of up to 57km long, measured along routes weighted for optimal pedestrian travel. In this case, the single call to <a href="https://atfutures.github.io/dodgr/reference/dodgr_distances.html"><code><a href="../reference/dodgr_distances.html">dodgr_distances()</a></code></a> automatically downloaded the entire street network of York and calculated one million shortest-path distances, all in under 30 seconds.</p>
</div>
<div id="graphs-and-street-networks" class="section level1">
<h1 class="hasAnchor">
<a href="#graphs-and-street-networks" class="anchor"></a>3 Graphs and Street Networks</h1>
<p>Although the above code is short and fast, most users will probably want more control over their graphs and routing possibilities. Each of the steps indicated above (through the <code>quiet = FALSE</code> option) can be implemented separately. To illustrate, the remainder of this vignette analyses the much smaller street network of Hampi, Karnataka, India, included in the <code>dodgr</code> package as the dataset <a href="https://atfutures.github.io/dodgr/reference/hampi.html"><code>hampi</code></a>. This data set may be re-created with the following single line:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1">hampi &lt;-<span class="st"> </span><span class="kw"><a href="../reference/dodgr_streetnet.html">dodgr_streetnet</a></span> (<span class="st">"hampi india"</span>)</a></code></pre></div>
<p>Or with the equivalent version bundled with the package:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/class.html">class</a></span> (hampi)</a></code></pre></div>
<pre><code>## [1] "sf"         "data.frame"</code></pre>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/class.html">class</a></span> (hampi<span class="op">$</span>geometry)</a></code></pre></div>
<pre><code>## [1] "sfc_LINESTRING" "sfc"</code></pre>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/dim.html">dim</a></span> (hampi)</a></code></pre></div>
<pre><code>## [1] 203  15</code></pre>
<p>The <code>streetnet</code> is an <a href="https://cran.r-project.org/package=sf"><code>sf</code></a> (Simple Features) object containing 189 <code>LINESTRING</code> geometries. In other words, it’s got an <code>sf</code> representation of 189 street segments. The <strong>R</strong> package <a href="https://ropensci.github.io/osmplotr"><code>osmplotr</code></a> can be used to visualise this street network (with the help of <code>magrittr</code> pipe operator, <code><a href="https://rdrr.io/pkg/magrittr/man/pipe.html">%&gt;%</a></code>):</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span> (osmplotr)</a>
<a class="sourceLine" id="cb23-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span> (magrittr)</a>
<a class="sourceLine" id="cb23-3" data-line-number="3">map &lt;-<span class="st"> </span><span class="kw">osm_basemap</span> (hampi, <span class="dt">bg =</span> <span class="st">"gray95"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb23-4" data-line-number="4"><span class="st">    </span><span class="kw">add_osm_objects</span> (hampi, <span class="dt">col =</span> <span class="st">"gray5"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb23-5" data-line-number="5"><span class="st">    </span><span class="kw">add_axes</span> () <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb23-6" data-line-number="6"><span class="st">    </span><span class="kw">print_osm_map</span> ()</a></code></pre></div>
<p><img src="hampi.png"></p>
<p>The <code>sf</code> class data representing the street network of Hampi can then be converted into a flat <code>data.frame</code> object by</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1">graph &lt;-<span class="st"> </span><span class="kw"><a href="../reference/weight_streetnet.html">weight_streetnet</a></span> (hampi, <span class="dt">wt_profile =</span> <span class="st">"foot"</span>)</a>
<a class="sourceLine" id="cb24-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/dim.html">dim</a></span> (graph)</a></code></pre></div>
<pre><code>## [1] 5973   15</code></pre>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span> (graph)</a></code></pre></div>
<pre><code>##   geom_num edge_id    from_id from_lon from_lat      to_id   to_lon
## 1        1       1  339318500 76.47489 15.34169  339318502 76.47612
## 2        1       2  339318502 76.47612 15.34173  339318500 76.47489
## 3        1       3  339318502 76.47612 15.34173 2398958028 76.47621
## 4        1       4 2398958028 76.47621 15.34174  339318502 76.47612
## 5        1       5 2398958028 76.47621 15.34174 1427116077 76.47628
## 6        1       6 1427116077 76.47628 15.34179 2398958028 76.47621
##     to_lat          d d_weighted      highway   way_id component      time
## 1 15.34173 132.442169  165.55271 unclassified 28565950         1 95.358362
## 2 15.34169 132.442169  165.55271 unclassified 28565950         1 95.358362
## 3 15.34174   8.888670   11.11084 unclassified 28565950         1  6.399842
## 4 15.34173   8.888670   11.11084 unclassified 28565950         1  6.399842
## 5 15.34179   9.326536   11.65817 unclassified 28565950         1  6.715106
## 6 15.34174   9.326536   11.65817 unclassified 28565950         1  6.715106
##   time_weighted
## 1    119.197952
## 2    119.197952
## 3      7.999803
## 4      7.999803
## 5      8.393882
## 6      8.393882</code></pre>
<p>Note that the actual graph contains around 30 times as many edges as there are streets, indicating that each street is composed on average of around 30 individual segments. The individual points points or vertices from those segments can be extracted with,</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" data-line-number="1">vt &lt;-<span class="st"> </span><span class="kw"><a href="../reference/dodgr_vertices.html">dodgr_vertices</a></span> (graph)</a>
<a class="sourceLine" id="cb28-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(vt)</a></code></pre></div>
<pre><code>##            id        x        y component n
## 1   339318500 76.47489 15.34169         1 0
## 2   339318502 76.47612 15.34173         1 1
## 4  2398958028 76.47621 15.34174         1 2
## 6  1427116077 76.47628 15.34179         1 3
## 8   339318503 76.47641 15.34190         1 4
## 10 2398958034 76.47650 15.34199         1 5</code></pre>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/dim.html">dim</a></span> (vt)</a></code></pre></div>
<pre><code>## [1] 2926    5</code></pre>
<p>From which we see that the OpenStreetMap representation of the streets of Hampi has 189 line segments with 2,987 unique points and 6,096 edges between those points. The number of edges per vertex in the entire network is thus,</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span> (graph) <span class="op">/</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span> (vt)</a></code></pre></div>
<pre><code>## [1] 2.041353</code></pre>
<p>A simple straight line has two edges between all intermediate nodes, and this thus indicates that the network in it’s entirety is quite simple. The <code>data.frame</code> resulting from <a href="https://atfutures.github.io/dodgr/reference/weight_streetnet.html"><code><a href="../reference/weight_streetnet.html">weight_streetnet()</a></code></a> is what <code>dodgr</code> uses to calculate shortest path routes, as will be described below, following a brief description of weighting street networks.</p>
<div id="graph-components" class="section level2">
<h2 class="hasAnchor">
<a href="#graph-components" class="anchor"></a>3.1 Graph Components</h2>
<p>The foregoing <code>graph</code> object returned from <a href="https://atfutures.github.io/dodgr/reference/weight_streetnet.html"><code><a href="../reference/weight_streetnet.html">weight_streetnet()</a></code></a> also includes a <code>$component</code> column enumerating all of the distinct inter-connected components of the graph.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/table.html">table</a></span> (graph<span class="op">$</span>component)</a></code></pre></div>
<pre><code>## 
##    1    2    3 
## 3891 2074    8</code></pre>
<p>Components are numbered in order of decreasing size, with <code>$component = 1</code> always denoting the largest component. In this case, that component contains 3,934 edges, representing 65% of the graph. There are clearly only three distinct components, but this number may be much larger for larger graphs, and may be obtained from,</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb36-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span> (<span class="kw"><a href="https://rdrr.io/r/base/unique.html">unique</a></span> (graph<span class="op">$</span>component))</a></code></pre></div>
<pre><code>## [1] 3</code></pre>
<p>Component numbers can be determined for any types of graph with the <a href="https://atfutures.github.io/dodgr/reference/dodgr_components.html"><code><a href="../reference/dodgr_components.html">dodgr_components()</a></code></a> function. For example, the following lines reduce the previous graph to a minimal (non-spatial) structure of four columns, and then (re-)calculate a fifth column of <code>$component</code>s:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb38-1" data-line-number="1">cols &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span> (<span class="st">"edge_id"</span>, <span class="st">"from_id"</span>, <span class="st">"to_id"</span>, <span class="st">"d"</span>)</a>
<a class="sourceLine" id="cb38-2" data-line-number="2">graph_min &lt;-<span class="st"> </span>graph [, <span class="kw"><a href="https://rdrr.io/r/base/which.html">which</a></span> (<span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span> (graph) <span class="op">%in%</span><span class="st"> </span>cols)]</a>
<a class="sourceLine" id="cb38-3" data-line-number="3">graph_min &lt;-<span class="st"> </span><span class="kw"><a href="../reference/dodgr_components.html">dodgr_components</a></span> (graph_min)</a>
<a class="sourceLine" id="cb38-4" data-line-number="4"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span> (graph_min)</a></code></pre></div>
<pre><code>##   edge_id    from_id      to_id          d component
## 1       1  339318500  339318502 132.442169         1
## 2       2  339318502  339318500 132.442169         1
## 3       3  339318502 2398958028   8.888670         1
## 4       4 2398958028  339318502   8.888670         1
## 5       5 2398958028 1427116077   9.326536         1
## 6       6 1427116077 2398958028   9.326536         1</code></pre>
<p>The <code>component</code> column column can be used to select or filter any component in a graph. It is particularly useful to ensure routing calculations consider only connected vertices through simply removing all minor components:</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb40-1" data-line-number="1">graph_connected &lt;-<span class="st"> </span>graph [graph<span class="op">$</span>component <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, ]</a></code></pre></div>
<p>This is explored further below (under Distance Matrices).</p>
</div>
<div id="weighting-profiles" class="section level2">
<h2 class="hasAnchor">
<a href="#weighting-profiles" class="anchor"></a>3.2 Weighting Profiles</h2>
<p>Dual-weights for street networks are generally obtained by multiplying the distance of each segment by a weighting factor reflecting the type of highway. As demonstrated above, this can be done easily within <code>dodgr</code> with the <a href="https://atfutures.github.io/dodgr/reference/weight_streetnet.html"><code><a href="../reference/weight_streetnet.html">weight_streetnet()</a></code></a> function, which applies the named weighting profiles included with the <code>dodgr</code> package to OpenStreetMap networks extracted with the <a href="https://cran.r-project.org/package=osmdata"><code>osmdata</code></a> package.</p>
<p>This function uses the internal data <a href="https://atfutures.github.io/dodgr/reference/weighting_profiles.html"><code><a href="../reference/weighting_profiles.html">dodgr::weighting_profiles</a></code></a>, which is a list of three items:</p>
<ol style="list-style-type: decimal">
<li>
<code>weighting_profiles</code>;</li>
<li>
<code>surface_speeds</code>; and</li>
<li><code>penalties</code></li>
</ol>
<p>Most of these data are used to calculate routing times with the <code>dodgr_times</code> function, as detailed in an additional vignette. The only aspects relevant for distances are the profiles themselves, which assign preferential weights to each distinct type of highway.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb41-1" data-line-number="1">wp &lt;-<span class="st"> </span>weighting_profiles<span class="op">$</span>weighting_profiles</a>
<a class="sourceLine" id="cb41-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span> (wp)</a></code></pre></div>
<pre><code>## [1] "name"      "way"       "value"     "max_speed"</code></pre>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb43-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/class.html">class</a></span> (wp)</a></code></pre></div>
<pre><code>## [1] "data.frame"</code></pre>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb45-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/unique.html">unique</a></span> (wp<span class="op">$</span>name)</a></code></pre></div>
<pre><code>##  [1] "foot"       "horse"      "wheelchair" "bicycle"    "moped"     
##  [6] "motorcycle" "motorcar"   "goods"      "hgv"        "psv"</code></pre>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb47-1" data-line-number="1">wp [wp<span class="op">$</span>name <span class="op">==</span><span class="st"> "foot"</span>, ]</a></code></pre></div>
<pre><code>##    name            way value max_speed
## 1  foot       motorway  0.00        NA
## 2  foot          trunk  0.40        NA
## 3  foot        primary  0.50         5
## 4  foot      secondary  0.60         5
## 5  foot       tertiary  0.70         5
## 6  foot   unclassified  0.80         5
## 7  foot    residential  0.90         5
## 8  foot        service  0.90         5
## 9  foot          track  0.95         5
## 10 foot       cycleway  0.95         5
## 11 foot           path  1.00         5
## 12 foot          steps  0.80         2
## 13 foot          ferry  0.20         5
## 14 foot  living_street  0.95         5
## 15 foot      bridleway  1.00         5
## 16 foot        footway  1.00         5
## 17 foot     pedestrian  1.00         5
## 18 foot  motorway_link  0.00        NA
## 19 foot     trunk_link  0.40        NA
## 20 foot   primary_link  0.50         5
## 21 foot secondary_link  0.60         5
## 22 foot  tertiary_link  0.70         5</code></pre>
<p>Each profile is defined by a series of percentage weights quantifying highway-type preferences for a particular mode of travel. The distinct types of highways within the Hampi graph obtained above can be tabulated with:</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb49-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/table.html">table</a></span> (graph<span class="op">$</span>highway)</a></code></pre></div>
<pre><code>## 
## living_street          path       primary   residential       service 
##           114          2695          1156            94           210 
##         steps      tertiary         track  unclassified 
##           102           324           508           770</code></pre>
<p>Hampi is unlike most other human settlements on the planet in being a Unesco World Heritage area in which automobiles are generally prohibited. Accordingly, numbers of <code>"footway"</code>, <code>"path"</code>, and <code>"pedestrian"</code> ways far exceed typical categories denoting automobile traffic (<code>"primary", "residential", "tertiary"</code>)</p>
<p>It is also possible to use other types of (non-OpenStreetMap) street networks, an example of which is the <a href="https://atfutures.github.io/dodgr/reference/os_roads_bristol.html"><code>os_roads_bristol</code></a> data provided with the package. “OS” is the U.K. Ordnance Survey, and these data are provided as a Simple Features (<a href="https://cran.r-project.org/package=sf"><code>sf</code></a>) <code>data.frame</code> with a decidedly different structure to <code>osmdata data.frame</code> objects:</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb51-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span> (hampi) <span class="co"># many fields manually removed to reduce size of this object</span></a></code></pre></div>
<pre><code>##  [1] "osm_id"        "bicycle"       "covered"       "foot"         
##  [5] "highway"       "incline"       "motorcar"      "motorcycle"   
##  [9] "motor_vehicle" "oneway"        "surface"       "tracktype"    
## [13] "tunnel"        "width"         "geometry"</code></pre>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb53-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span> (os_roads_bristol)</a></code></pre></div>
<pre><code>##  [1] "fictitious" "identifier" "class"      "roadNumber" "name1"     
##  [6] "name1_lang" "name2"      "name2_lang" "formOfWay"  "length"    
## [11] "primary"    "trunkRoad"  "loop"       "startNode"  "endNode"   
## [16] "structure"  "nameTOID"   "numberTOID" "function."  "geometry"</code></pre>
<p>The latter may be converted to a <code>dodgr</code> network by first specifying a weighting profile, here based on the <code>formOfWay</code> column:</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb55-1" data-line-number="1">colnm &lt;-<span class="st"> "formOfWay"</span></a>
<a class="sourceLine" id="cb55-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/table.html">table</a></span> (os_roads_bristol [[colnm]])</a></code></pre></div>
<pre><code>## 
## Collapsed Dual Carriageway           Dual Carriageway 
##                         14                          6 
##         Single Carriageway                  Slip Road 
##                          1                          8</code></pre>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb57-1" data-line-number="1">wts &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span> (<span class="dt">name =</span> <span class="st">"custom"</span>,</a>
<a class="sourceLine" id="cb57-2" data-line-number="2">                   <span class="dt">way =</span> <span class="kw"><a href="https://rdrr.io/r/base/unique.html">unique</a></span> (os_roads_bristol [[colnm]]),</a>
<a class="sourceLine" id="cb57-3" data-line-number="3">                   <span class="dt">value =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span> (<span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="fl">0.8</span>, <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb57-4" data-line-number="4">net &lt;-<span class="st"> </span><span class="kw"><a href="../reference/weight_streetnet.html">weight_streetnet</a></span> (os_roads_bristol, <span class="dt">wt_profile =</span> wts,</a>
<a class="sourceLine" id="cb57-5" data-line-number="5">                         <span class="dt">type_col =</span> colnm, <span class="dt">id_col =</span> <span class="st">"identifier"</span>)</a></code></pre></div>
<p>The resultant <code>net</code> object contains the street network of <a href="https://atfutures.github.io/dodgr/reference/os_roads_bristol.html"><code>os_roads_bristol</code></a> weighted by the specified profile, and in a format suitable for submission to any <code>dodgr</code> routine.</p>
</div>
<div id="random-sub-graphs" class="section level2">
<h2 class="hasAnchor">
<a href="#random-sub-graphs" class="anchor"></a>3.3 Random Sub-Graphs</h2>
<p>The <code>dodgr</code> packages includes a function to select a random connected portion of graph including a specified number of vertices. This function is used in the <a href="https://atfutures.github.io/dodgr/reference/compare_heaps.html"><code><a href="../reference/compare_heaps.html">compare_heaps()</a></code></a> function described below, but is also useful for general statistical analyses of large graphs which may otherwise take too long to compute.</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb58-1" data-line-number="1">graph_sub &lt;-<span class="st"> </span><span class="kw"><a href="../reference/dodgr_sample.html">dodgr_sample</a></span> (graph, <span class="dt">nverts =</span> <span class="dv">100</span>)</a>
<a class="sourceLine" id="cb58-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span> (graph_sub)</a></code></pre></div>
<pre><code>## [1] 197</code></pre>
<p>The random sample has around twice as many edges as vertices, in accordance with the statistics calculated above.</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb60-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span> (<span class="kw"><a href="../reference/dodgr_vertices.html">dodgr_vertices</a></span> (graph_sub))</a></code></pre></div>
<pre><code>## [1] 100</code></pre>
</div>
</div>
<div id="distance-matrices-dodgr_dists" class="section level1">
<h1 class="hasAnchor">
<a href="#distance-matrices-dodgr_dists" class="anchor"></a>4 Distance Matrices: <code>dodgr_dists()</code>
</h1>
<p>As demonstrated at the outset, an entire network can simply be submitted to <a href="https://atfutures.github.io/dodgr/reference/dodgr_distances.html"><code><a href="../reference/dodgr_distances.html">dodgr_distances()</a></code></a>, in which case a square matrix will be returned containing pair-wise distances between all vertices. Doing that for the <code>graph</code> of York will return a square matrix of around 90,000-times-90,000 (or 8 billion) distances. It might be possible to do that on some computers, but is possibly neither recommended nor desirable. The <a href="https://atfutures.github.io/dodgr/reference/dodgr_distances.html"><code><a href="../reference/dodgr_distances.html">dodgr_distances()</a></code></a> function accepts additional arguments of <code>from</code> and <code>to</code> defining points from and to which distances are to be calculated. If only <code>from</code> is provided, a square matrix is returned of pair-wise distances between all listed points.</p>
<div id="aligning-routing-points-to-graphs" class="section level2">
<h2 class="hasAnchor">
<a href="#aligning-routing-points-to-graphs" class="anchor"></a>4.1 Aligning Routing Points to Graphs</h2>
<p>For spatial graphs—that is, those containing columns of latitudes and longitudes (or “x” and “y”)—routing points can be represented by a simple matrix of arbitrary latitudes and longitudes (or, again, “x” and “y”). <a href="https://atfutures.github.io/dodgr/reference/dodgr_distances.html"><code><a href="../reference/dodgr_distances.html">dodgr_distances()</a></code></a> will map these points to the closest network points, and return corresponding shortest-path distances. This may be illustrated by generating random points within the bounding box of the above map of Hampi. As demonstrated above, the coordinates of all vertices may be extracted with the <a href="https://atfutures.github.io/dodgr/reference/dodgr_vertices.html"><code><a href="../reference/dodgr_vertices.html">dodgr_vertices()</a></code></a> function, enabling random points to be generated with the following lines:</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb62-1" data-line-number="1">vt &lt;-<span class="st"> </span><span class="kw"><a href="../reference/dodgr_vertices.html">dodgr_vertices</a></span> (graph)</a>
<a class="sourceLine" id="cb62-2" data-line-number="2">n &lt;-<span class="st"> </span><span class="dv">100</span> <span class="co"># number of points to generate</span></a>
<a class="sourceLine" id="cb62-3" data-line-number="3">xy &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span> (<span class="dt">x =</span> <span class="kw"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span> (vt<span class="op">$</span>x) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span> (n) <span class="op">*</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/diff.html">diff</a></span> (<span class="kw"><a href="https://rdrr.io/r/base/range.html">range</a></span> (vt<span class="op">$</span>x)),</a>
<a class="sourceLine" id="cb62-4" data-line-number="4">                  <span class="dt">y =</span> <span class="kw"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span> (vt<span class="op">$</span>y) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span> (n) <span class="op">*</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/diff.html">diff</a></span> (<span class="kw"><a href="https://rdrr.io/r/base/range.html">range</a></span> (vt<span class="op">$</span>y)))</a></code></pre></div>
<p>Submitting these to <a href="https://atfutures.github.io/dodgr/reference/dodgr_distances.html"><code><a href="../reference/dodgr_distances.html">dodgr_distances()</a></code></a> as points <strong>from</strong> which to route will generate a distance matrix from each of these 100 points to every other point in the graph:</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb63-1" data-line-number="1">d &lt;-<span class="st"> </span><span class="kw"><a href="../reference/dodgr_dists.html">dodgr_dists</a></span> (graph, <span class="dt">from =</span> xy)</a>
<a class="sourceLine" id="cb63-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/dim.html">dim</a></span> (d); <span class="kw"><a href="https://rdrr.io/r/base/range.html">range</a></span> (d, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## [1]  100 2926</code></pre>
<pre><code>## [1]     0.00 28677.34</code></pre>
<p>If the <code>to</code> argument is also specified, the matrix returned will have rows matching <code>from</code> and columns matching <code>to</code></p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb66-1" data-line-number="1">d &lt;-<span class="st"> </span><span class="kw"><a href="../reference/dodgr_dists.html">dodgr_dists</a></span> (graph, <span class="dt">from =</span> xy, <span class="dt">to =</span> xy [<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, ])</a>
<a class="sourceLine" id="cb66-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/dim.html">dim</a></span> (d)</a></code></pre></div>
<pre><code>## [1] 100  10</code></pre>
<p>Some of the resultant distances in the above cases are <code>NA</code> because the points were sampled from the entire bounding box, and the street network near the boundaries may be cut off from the rest. As demonstrated above, the <a href="https://atfutures.github.io/dodgr/reference/weight_streetnet.html"><code><a href="../reference/weight_streetnet.html">weight_streetnet()</a></code></a> function returns a <code>component</code> vector, and such disconnected edges will have <code>graph$component &gt; 1</code>, because <code>graph$component == 1</code> always denotes the largest connected component. This means that the graph can always be reduced to the single largest component with the following single line:</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb68-1" data-line-number="1">graph_connected &lt;-<span class="st"> </span>graph [graph<span class="op">$</span>component <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, ]</a></code></pre></div>
<p>A distance matrix obtained from running <a href="https://atfutures.github.io/dodgr/reference/dodgr_distances.html"><code>dodgr_distances</code></a> on <code>graph_connected</code> should generally contain no <code>NA</code> values, although some points may still be effectively unreachable due to one-way connections (or streets). Thus, routing on the largest connected component of a directed graph ought to be expected to yield the <em>minimal</em> number of <code>NA</code> values, which may sometimes be more than zero. Note further that spatial routing points (expressed as <code>from</code> and/or <code>to</code> arguments) will in this case be mapped to the nearest vertices of <code>graph_connected</code>, rather than the potentially closer nearest points of the full <code>graph</code>. This may make the spatial mapping of routing points less accurate than results obtained by repeating extraction of the street network using an expanded bounding box. For automatic extraction of street networks with <a href="https://atfutures.github.io/dodgr/reference/dodgr_distances.html"><code><a href="../reference/dodgr_distances.html">dodgr_distances()</a></code></a>, the extent by which the bounding box exceeds the range of routing points (<code>from</code> and <code>to</code> arguments) is determined by an extra parameter <code>expand</code>, quantifying the relative extent to which the bounding box should exceed the spatial range of the routing points. This is illustrated in the following code which calculates distances between 100 random points:</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb69-1" data-line-number="1">bb &lt;-<span class="st"> </span>osmdata<span class="op">::</span><span class="kw"><a href="https://docs.ropensci.org/osmdata/reference/getbb.html">getbb</a></span> (<span class="st">"york uk"</span>)</a>
<a class="sourceLine" id="cb69-2" data-line-number="2">npts &lt;-<span class="st"> </span><span class="dv">100</span></a>
<a class="sourceLine" id="cb69-3" data-line-number="3">xy &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/apply.html">apply</a></span> (bb, <span class="dv">1</span>, <span class="cf">function</span> (i) <span class="kw"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span> (i) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span> (npts) <span class="op">*</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/diff.html">diff</a></span> (i))</a>
<a class="sourceLine" id="cb69-4" data-line-number="4">routed_points &lt;-<span class="st"> </span><span class="cf">function</span> (<span class="dt">expand =</span> <span class="dv">0</span>, pts)</a>
<a class="sourceLine" id="cb69-5" data-line-number="5">{</a>
<a class="sourceLine" id="cb69-6" data-line-number="6">    gr0 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/dodgr_streetnet.html">dodgr_streetnet</a></span> (<span class="dt">pts =</span> pts, <span class="dt">expand =</span> expand) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb69-7" data-line-number="7"><span class="st">        </span><span class="kw"><a href="../reference/weight_streetnet.html">weight_streetnet</a></span> ()</a>
<a class="sourceLine" id="cb69-8" data-line-number="8">    d0 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/dodgr_dists.html">dodgr_dists</a></span> (gr0, <span class="dt">from =</span> pts)</a>
<a class="sourceLine" id="cb69-9" data-line-number="9">    <span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span> (<span class="kw"><a href="https://rdrr.io/r/base/which.html">which</a></span> (<span class="kw"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span> (d0))) <span class="op">/</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span> (d0)</a>
<a class="sourceLine" id="cb69-10" data-line-number="10">}</a></code></pre></div>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb70-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/lapply.html">vapply</a></span> (<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span> (<span class="dv">0</span>, <span class="fl">0.05</span>, <span class="fl">0.1</span>, <span class="fl">0.2</span>), <span class="cf">function</span> (i) <span class="kw">routed_points</span> (i, <span class="dt">pts =</span> xy),</a>
<a class="sourceLine" id="cb70-2" data-line-number="2">        <span class="kw"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span> (<span class="dv">1</span>))</a></code></pre></div>
<pre><code>## [1] 0.04007477 0.02326452 0.02131992 0.00000000</code></pre>
<p>With a street network that precisely encompasses the submitted routing points (<code>expand = 0</code>), 4% of pairwise distances are unable to be calculated; with a bounding box expanded to 5% larger than the submitted points, this is reduced to 2.3%, and with expansion to 20%, all points can be connected.</p>
<p>For non-spatial graphs, <code>from</code> and <code>to</code> must match precisely on to vertices named in the graph itself. In the graph considered above, these vertex names were contained in the columns, <code>from_id</code> and <code>to_id</code>. The minimum that a <code>dodgr</code> graph requires is,</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb72-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span> (graph [, <span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span> (graph) <span class="op">%in%</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span> (<span class="st">"from_id"</span>, <span class="st">"to_id"</span>, <span class="st">"d"</span>)])</a></code></pre></div>
<pre><code>##      from_id      to_id          d
## 1  339318500  339318502 132.442169
## 2  339318502  339318500 132.442169
## 3  339318502 2398958028   8.888670
## 4 2398958028  339318502   8.888670
## 5 2398958028 1427116077   9.326536
## 6 1427116077 2398958028   9.326536</code></pre>
<p>in which case the <code>from</code> values submitted to <code><a href="../reference/dodgr_dists.html">dodgr_dists()</a></code> (and <code>to</code>, if given) must directly name the vertices in the <code>from_id</code> and <code>to_id</code> columns of the graph. This is illustrated in the following code:</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb74-1" data-line-number="1">graph_min &lt;-<span class="st"> </span>graph [, <span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span> (graph) <span class="op">%in%</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span> (<span class="st">"from_id"</span>, <span class="st">"to_id"</span>, <span class="st">"d"</span>)]</a>
<a class="sourceLine" id="cb74-2" data-line-number="2">fr &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/sample.html">sample</a></span> (graph_min<span class="op">$</span>from_id, <span class="dt">size =</span> <span class="dv">10</span>) <span class="co"># 10 random points</span></a>
<a class="sourceLine" id="cb74-3" data-line-number="3">to &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/sample.html">sample</a></span> (graph_min<span class="op">$</span>to_id, <span class="dt">size =</span> <span class="dv">20</span>)</a>
<a class="sourceLine" id="cb74-4" data-line-number="4">d &lt;-<span class="st"> </span><span class="kw"><a href="../reference/dodgr_dists.html">dodgr_dists</a></span> (graph_min, <span class="dt">from =</span> fr, <span class="dt">to =</span> to)</a>
<a class="sourceLine" id="cb74-5" data-line-number="5"><span class="kw"><a href="https://rdrr.io/r/base/dim.html">dim</a></span> (d)</a></code></pre></div>
<pre><code>## [1] 10 20</code></pre>
<p>The result is a 10-by-20 matrix of distances between these named graph vertices.</p>
</div>
<div id="shortest-path-calculations-priority-queues" class="section level2">
<h2 class="hasAnchor">
<a href="#shortest-path-calculations-priority-queues" class="anchor"></a>4.2 Shortest Path Calculations: Priority Queues</h2>
<p><code>dodgr</code> uses an internal library <span class="citation">(Saunders and Takaoka 2003, <span class="citation">@Saunders2004</span>)</span> for the calculation of shortest paths using a variety of priority queues <span class="citation">(see Miller 1960 for an overview)</span>. In the context of shortest paths, priority queues determine the order in which a graph is traversed <span class="citation">(Tarjan 1983)</span>, and the choice of priority queue can have a considerable effect on computational efficiency for different kinds of graphs <span class="citation">(Johnson 1977)</span>. In contrast to <code>dodgr</code>, most other <strong>R</strong> packages for shortest path calculations do not use priority queues, and so may often be less efficient. Shortest path distances can be calculated in <code>dodgr</code> with priority queues that use the following heaps:</p>
<ol style="list-style-type: decimal">
<li>Binary heaps;</li>
<li>Fibonacci heaps <span class="citation">(Fredman and Tarjan 1987)</span>;</li>
<li>Trinomial and extended trinomial heaps <span class="citation">(Takaoka 2000)</span>; and</li>
<li>2-3 heaps <span class="citation">(Takaoka 1999)</span>.</li>
</ol>
<p>Differences in how these heaps operate are often largely extraneous to direct application of routing algorithms, even though heap choice may strongly affect performance. To avoid users needing to know anything about algorithmic details, <code>dodgr</code> provides a function <a href="https://atfutures.github.io/dodgr/reference/compare_heaps.html"><code><a href="../reference/compare_heaps.html">compare_heaps()</a></code></a> to which a particular graph may be submitted in order to determine the optimal kind of heap.</p>
<p>The comparisons are actually made on a randomly selected sub-component of the graph containing a defined number of vertices (with a default of 1,000, or the entire graph if it contains fewer than 1,000 vertices).</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb76-1" data-line-number="1"><span class="kw"><a href="../reference/compare_heaps.html">compare_heaps</a></span> (graph, <span class="dt">nverts =</span> <span class="dv">1000</span>, <span class="dt">replications =</span> <span class="dv">1</span>)</a></code></pre></div>
<pre><code>## Loading required namespace: rbenchmark</code></pre>
<pre><code>##                                                                                   test
## 6       d &lt;- dodgr_dists(graph_contracted, from = from_id, to = to_id, heap = "BHeap")
## 7       d &lt;- dodgr_dists(graph_contracted, from = from_id, to = to_id, heap = "FHeap")
## 10     d &lt;- dodgr_dists(graph_contracted, from = from_id, to = to_id, heap = "Heap23")
## 11        d &lt;- dodgr_dists(graph_contracted, from = from_id, to = to_id, heap = "set")
## 8     d &lt;- dodgr_dists(graph_contracted, from = from_id, to = to_id, heap = "TriHeap")
## 9  d &lt;- dodgr_dists(graph_contracted, from = from_id, to = to_id, heap = "TriHeapExt")
## 1                  d &lt;- dodgr_dists(graph, from = from_id, to = to_id, heap = "BHeap")
## 12                  d &lt;- igraph::distances(igr, v = from_id, to = to_id, mode = "out")
## 2                  d &lt;- dodgr_dists(graph, from = from_id, to = to_id, heap = "FHeap")
## 5                 d &lt;- dodgr_dists(graph, from = from_id, to = to_id, heap = "Heap23")
## 3                d &lt;- dodgr_dists(graph, from = from_id, to = to_id, heap = "TriHeap")
## 4             d &lt;- dodgr_dists(graph, from = from_id, to = to_id, heap = "TriHeapExt")
##    replications elapsed relative user.self sys.self user.child sys.child
## 6             1   0.003    1.000     0.004    0.000          0         0
## 7             1   0.003    1.000     0.004    0.000          0         0
## 10            1   0.003    1.000     0.005    0.000          0         0
## 11            1   0.003    1.000     0.004    0.000          0         0
## 8             1   0.004    1.333     0.004    0.000          0         0
## 9             1   0.004    1.333     0.003    0.000          0         0
## 1             1   0.009    3.000     0.014    0.001          0         0
## 12            1   0.011    3.667     0.011    0.000          0         0
## 2             1   0.014    4.667     0.023    0.000          0         0
## 5             1   0.015    5.000     0.024    0.000          0         0
## 3             1   0.017    5.667     0.026    0.000          0         0
## 4             1   0.017    5.667     0.017    0.000          0         0</code></pre>
<p>The key column of that <code>data.frame</code> is <code>relative</code>, which quantifies the relative performance of each test in relation to the best which is given a score of 1. <code>dodgr</code> using the default <code>heap = "BHeap"</code>, which is a binary heap priority queue, performs faster than <a href="https://igraph.org"><code>igraph</code></a> <span class="citation">(Csardi and Nepusz 2006)</span> for these graphs. Different kind of graphs will perform differently with different priority queue structures, and this function enables users to empirically discern the optimal heap for their kind of graph.</p>
<p>Note, however, that this is not an entirely fair comparison, because <code>dodgr</code> calculates dual-weighted distances, whereas <a href="https://igraph.org"><code>igraph</code></a>—and indeed all other <strong>R</strong> packages—only directly calculate distances based on a single set of weights. Implementing dual-weighted routing in these cases requires explicitly re-tracing all paths and summing the second set of weights along each path. A time comparison in that case would be very strongly in favour of <code>dodgr</code>. Moreover, <code>dodgr</code> can convert graphs to contracted form through removing redundant vertices, as detailed in the following section. Doing so greatly improves performance with respect to <a href="https://igraph.org"><code>igraph</code></a>.</p>
<p>For those wishing to do explicit comparisons themselves, the following code generates the <a href="https://igraph.org"><code>igraph</code></a> equivalent of <a href="https://atfutures.github.io/dodgr/reference/dodgr_distances.html"><code><a href="../reference/dodgr_distances.html">dodgr_distances()</a></code></a>, although of course for single-weighted graphs only:</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb79-1" data-line-number="1">v &lt;-<span class="st"> </span><span class="kw"><a href="../reference/dodgr_vertices.html">dodgr_vertices</a></span> (graph)</a>
<a class="sourceLine" id="cb79-2" data-line-number="2">pts &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/sample.html">sample</a></span> (v<span class="op">$</span>id, <span class="dv">1000</span>)</a>
<a class="sourceLine" id="cb79-3" data-line-number="3">igr &lt;-<span class="st"> </span><span class="kw"><a href="../reference/dodgr_to_igraph.html">dodgr_to_igraph</a></span> (graph)</a>
<a class="sourceLine" id="cb79-4" data-line-number="4">d &lt;-<span class="st"> </span>igraph<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/igraph/man/distances.html">distances</a></span> (igr, <span class="dt">v =</span> pts, <span class="dt">to =</span> pts, <span class="dt">mode =</span> <span class="st">"out"</span>)</a></code></pre></div>
</div>
</div>
<div id="graph-contraction" class="section level1">
<h1 class="hasAnchor">
<a href="#graph-contraction" class="anchor"></a>5 Graph Contraction</h1>
<p>A further unique feature of <code>dodgr</code> is the ability to remove redundant vertices from graphs (see Fig. 3), thereby speeding up routing calculations.</p>
<p><img src="fig3.png"></p>
<p>In Fig. 3(A), the only way to get from vertex 1 to 3, 4 or 5 is through C. The intermediate vertex B is redundant for routing purposes (and than to or from that precise point) and may simply be removed, with directional edges inserted directly between vertices 1 and 3. This yields the equivalent contracted graph of Fig. 3(B), in which, for example, the distance (or weight) between 1 and 3 is the sum of previous distances (or weights) between 1 <span class="math inline">\(\to\)</span> 2 and 2 <span class="math inline">\(\to\)</span> 3. Note that if one of the two edges between, say, 3 and 2 were removed, vertex 2 would no longer be redundant (Fig. 3(C)).</p>
<p>Different kinds of graphs have different degrees of redundancy, and even street networks differ, through for example dense inner-urban networks generally being less redundant than less dense extra-urban or rural networks. The contracted version of a graph can be obtained with the function <a href="https://atfutures.github.io/dodgr/reference/dodgr_contract_graph.html"><code><a href="../reference/dodgr_contract_graph.html">dodgr_contract_graph()</a></code></a>, illustrated here with the York example from above.</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb80-1" data-line-number="1">grc &lt;-<span class="st"> </span><span class="kw"><a href="../reference/dodgr_contract_graph.html">dodgr_contract_graph</a></span> (graph)</a></code></pre></div>
<p>The function <a href="https://atfutures.github.io/dodgr/reference/dodgr_contract_graph.html"><code><a href="../reference/dodgr_contract_graph.html">dodgr_contract_graph()</a></code></a> returns the contracted version of the original graph, containing the same number of columns, but with each row representing an edge between two junction vertices (or between the submitted <code>verts</code>, which may or may not be junctions). Relative sizes are</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb81-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span> (graph); <span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span> (grc); <span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span> (grc) <span class="op">/</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span> (graph)</a></code></pre></div>
<pre><code>## [1] 5973</code></pre>
<pre><code>## [1] 672</code></pre>
<pre><code>## [1] 0.1125063</code></pre>
<p>equivalent to the removal of around 90% of all edges. The difference in routing efficiency can then be seen with the following code</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb85-1" data-line-number="1">from &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/sample.html">sample</a></span> (grc<span class="op">$</span>from_id, <span class="dt">size =</span> <span class="dv">100</span>)</a>
<a class="sourceLine" id="cb85-2" data-line-number="2">to &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/sample.html">sample</a></span> (grc<span class="op">$</span>to_id, <span class="dt">size =</span> <span class="dv">100</span>)</a>
<a class="sourceLine" id="cb85-3" data-line-number="3">rbenchmark<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/rbenchmark/man/benchmark.html">benchmark</a></span> (</a>
<a class="sourceLine" id="cb85-4" data-line-number="4">                       d2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/dodgr_dists.html">dodgr_dists</a></span> (grc, <span class="dt">from =</span> from, <span class="dt">to =</span> to),</a>
<a class="sourceLine" id="cb85-5" data-line-number="5">                       d2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/dodgr_dists.html">dodgr_dists</a></span> (graph, <span class="dt">from =</span> from, <span class="dt">to =</span> to),</a>
<a class="sourceLine" id="cb85-6" data-line-number="6">                       <span class="dt">replications =</span> <span class="dv">2</span>)</a></code></pre></div>
<pre><code>##                                             test replications elapsed
## 2 d2 &lt;- dodgr_dists(graph, from = from, to = to)            2   0.046
## 1   d2 &lt;- dodgr_dists(grc, from = from, to = to)            2   0.008
##   relative user.self sys.self user.child sys.child
## 2     5.75     0.067        0          0         0
## 1     1.00     0.010        0          0         0</code></pre>
<p>And contracting the graph has a similar effect of speeding up pairwise routing between these 100 points. All routing algorithms scale non-linearly with size, and relative improvements in efficiency will be even greater for larger graphs.</p>
<div id="routing-on-contracted-graphs" class="section level2">
<h2 class="hasAnchor">
<a href="#routing-on-contracted-graphs" class="anchor"></a>5.1 Routing on Contracted Graphs</h2>
<p>Routing is often desired between defined points, and these points may inadvertently be removed in graph contraction. The <a href="https://atfutures.github.io/dodgr/reference/dodgr_contract_graph.html"><code><a href="../reference/dodgr_contract_graph.html">dodgr_contract_graph()</a></code></a> function accepts an additional argument specifying vertices to keep within the contracted graph. This list of vertices must directly match the vertex ID values in the graph.</p>
<p>The following code illustrates how to retain specific vertices within contracted graphs:</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb87-1" data-line-number="1">grc &lt;-<span class="st"> </span><span class="kw"><a href="../reference/dodgr_contract_graph.html">dodgr_contract_graph</a></span> (graph)</a>
<a class="sourceLine" id="cb87-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span> (grc)</a></code></pre></div>
<pre><code>## [1] 672</code></pre>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb89-1" data-line-number="1">verts &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/sample.html">sample</a></span> (<span class="kw"><a href="../reference/dodgr_vertices.html">dodgr_vertices</a></span> (graph)<span class="op">$</span>id, <span class="dt">size =</span> <span class="dv">100</span>)</a>
<a class="sourceLine" id="cb89-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span> (verts) <span class="co"># a character vector</span></a></code></pre></div>
<pre><code>## [1] "4337842051" "2398957689" "286632900"  "5351820856" "2195424979"
## [6] "1376769010"</code></pre>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb91-1" data-line-number="1">grc &lt;-<span class="st"> </span><span class="kw"><a href="../reference/dodgr_contract_graph.html">dodgr_contract_graph</a></span> (graph, verts)</a>
<a class="sourceLine" id="cb91-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span> (grc)</a></code></pre></div>
<pre><code>## [1] 850</code></pre>
<p>Retaining the nominated vertices yields a graph with considerably more edges than the fully contracted graph excluding these vertices. The <a href="https://atfutures.github.io/dodgr/reference/dodgr_distances.html"><code><a href="../reference/dodgr_distances.html">dodgr_distances()</a></code></a> function can be applied to the latter graph to obtain accurate distances precisely routed between these points, yet using the speed advantages of graph contraction.</p>
</div>
</div>
<div id="shortest-paths" class="section level1">
<h1 class="hasAnchor">
<a href="#shortest-paths" class="anchor"></a>6 Shortest Paths</h1>
<p>Shortest paths can also be extracted with the <a href="https://atfutures.github.io/dodgr/reference/dodgr_paths.html"><code><a href="../reference/dodgr_paths.html">dodgr_paths()</a></code></a> function. For given vectors of <code>from</code> and <code>to</code> points, this returns a nested list so that if,</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb93-1" data-line-number="1">dp &lt;-<span class="st"> </span><span class="kw"><a href="../reference/dodgr_paths.html">dodgr_paths</a></span> (graph, <span class="dt">from =</span> from, <span class="dt">to =</span> to)</a></code></pre></div>
<p>then <code>dp [[i]] [[j]]</code> will contain the path from <code>from [i]</code> to <code>to [j]</code>. The paths are represented as sequences of vertex names. Consider the following example,</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb94-1" data-line-number="1">graph &lt;-<span class="st"> </span><span class="kw"><a href="../reference/weight_streetnet.html">weight_streetnet</a></span> (hampi, <span class="dt">wt_profile =</span> <span class="st">"foot"</span>)</a>
<a class="sourceLine" id="cb94-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span> (graph)</a></code></pre></div>
<pre><code>##   geom_num edge_id    from_id from_lon from_lat      to_id   to_lon
## 1        1       1  339318500 76.47489 15.34169  339318502 76.47612
## 2        1       2  339318502 76.47612 15.34173  339318500 76.47489
## 3        1       3  339318502 76.47612 15.34173 2398958028 76.47621
## 4        1       4 2398958028 76.47621 15.34174  339318502 76.47612
## 5        1       5 2398958028 76.47621 15.34174 1427116077 76.47628
## 6        1       6 1427116077 76.47628 15.34179 2398958028 76.47621
##     to_lat          d d_weighted      highway   way_id component      time
## 1 15.34173 132.442169  165.55271 unclassified 28565950         1 95.358362
## 2 15.34169 132.442169  165.55271 unclassified 28565950         1 95.358362
## 3 15.34174   8.888670   11.11084 unclassified 28565950         1  6.399842
## 4 15.34173   8.888670   11.11084 unclassified 28565950         1  6.399842
## 5 15.34179   9.326536   11.65817 unclassified 28565950         1  6.715106
## 6 15.34174   9.326536   11.65817 unclassified 28565950         1  6.715106
##   time_weighted
## 1    119.197952
## 2    119.197952
## 3      7.999803
## 4      7.999803
## 5      8.393882
## 6      8.393882</code></pre>
<p>The columns of <code>from_id</code> and <code>to_id</code> contain the names of the vertices. To extract shortest paths between some of these, first take some small samples of <code>from</code> and <code>to</code> points, and submit them to <a href="https://atfutures.github.io/dodgr/reference/dodgr_paths.html"><code><a href="../reference/dodgr_paths.html">dodgr_paths()</a></code></a>:</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb96-1" data-line-number="1">from &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/sample.html">sample</a></span> (graph<span class="op">$</span>from_id, <span class="dt">size =</span> <span class="dv">10</span>)</a>
<a class="sourceLine" id="cb96-2" data-line-number="2">to &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/sample.html">sample</a></span> (graph<span class="op">$</span>to_id, <span class="dt">size =</span> <span class="dv">5</span>)</a>
<a class="sourceLine" id="cb96-3" data-line-number="3">dp &lt;-<span class="st"> </span><span class="kw"><a href="../reference/dodgr_paths.html">dodgr_paths</a></span> (graph, <span class="dt">from =</span> from, <span class="dt">to =</span> to)</a>
<a class="sourceLine" id="cb96-4" data-line-number="4"><span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span> (dp)</a></code></pre></div>
<pre><code>## [1] 10</code></pre>
<p>The result (<code>dp</code>) is a list of 10 items, each of which contains 5 vectors. An example is,</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb98-1" data-line-number="1">dp [[<span class="dv">1</span>]] [[<span class="dv">1</span>]]</a></code></pre></div>
<pre><code>##  [1] "1148814946" "1148814822" "977472750"  "1148815260" "1143452479"
##  [6] "3921511683" "3921511686" "3921511682" "3921511676" "3921511685"
## [11] "3921511678" "3921511677" "3921511687" "3921511688" "3921511690"
## [16] "3921511689" "3921511681" "3921511680" "3921511679" "2627428645"
## [21] "2627428641" "2627428646" "2627428638" "2627428651" "2627430653"
## [26] "2627428637" "2627428647" "2627428629" "2627428627" "2627428628"
## [31] "2627428631" "2627428633" "2627428625" "1143452165" "1143452327"
## [36] "1143452463" "1143452113" "1143452207" "1143452383" "1143452534"
## [41] "1143452145" "2627440420" "2627440424" "1143452232" "1143452410"
## [46] "1143452262" "1143452379" "1143452183" "1143452174" "1143452087"
## [51] "1143452415" "1143452293" "1143452135" "1143452063" "1143452360"
## [56] "1143452234" "1143452099" "1143452506" "3697940688" "3697940693"
## [61] "571423793"  "1143452264" "571423799"  "1143452116" "1143452536"
## [66] "571423809"  "571423815"  "571423818"  "1143452332" "571423819" 
## [71] "2627444770" "1143452467" "571423820"  "571423821"  "571423823" 
## [76] "571423824"  "2627444771" "2627444772" "2627444773" "571423157" 
## [81] "571423164"  "571423169"  "3921514718" "2627444775" "571423170" 
## [86] "2627444774" "977490136"  "1143452068" "1143452367" "977490059" 
## [91] "2195424990" "2195424987" "2195424986" "2195424994"</code></pre>
<p>For spatial graphs, the coordinates of these paths can be obtained by extracting the vertices with <code><a href="../reference/dodgr_vertices.html">dodgr_vertices()</a></code> and matching the vertex IDs:</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb100-1" data-line-number="1">verts &lt;-<span class="st"> </span><span class="kw"><a href="../reference/dodgr_vertices.html">dodgr_vertices</a></span> (graph)</a>
<a class="sourceLine" id="cb100-2" data-line-number="2">path1 &lt;-<span class="st"> </span>verts [<span class="kw"><a href="https://rdrr.io/r/base/match.html">match</a></span> (dp [[<span class="dv">1</span>]] [[<span class="dv">1</span>]], verts<span class="op">$</span>id), ]</a>
<a class="sourceLine" id="cb100-3" data-line-number="3"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span> (path1)</a></code></pre></div>
<pre><code>##              id        x        y component    n
## 1988 1148814946 76.46383 15.34020         2 1006
## 1986 1148814822 76.46361 15.34053         2 1005
## 1984  977472750 76.46341 15.34068         2 1004
## 1982 1148815260 76.46333 15.34081         2 1003
## 1980 1143452479 76.46321 15.34090         2 1002
## 1978 3921511683 76.46314 15.34098         2 1001</code></pre>
<p>Paths calculated on contracted graphs will of course have fewer vertices than those calculated on full graphs.</p>
</div>
<div id="aggregated-flows" class="section level1">
<h1 class="hasAnchor">
<a href="#aggregated-flows" class="anchor"></a>7 Aggregated Flows</h1>
<p>The final major functions of <code>dodgr</code> are <a href="https://atfutures.github.io/dodgr/reference/dodgr_flows_aggregate.html"><code><a href="../reference/dodgr_flows_aggregate.html">dodgr_flows_aggregate()</a></code></a> and <a href="https://atfutures.github.io/dodgr/reference/dodgr_flows_disperse.html"><code><a href="../reference/dodgr_flows_disperse.html">dodgr_flows_disperse()</a></code></a>.</p>
<div id="direct-aggregation" class="section level2">
<h2 class="hasAnchor">
<a href="#direct-aggregation" class="anchor"></a>7.1 Direct Aggregation</h2>
<p>The former of the above functions aggregates ‘’flows’’ throughout a network from a set of origin (<code>from</code>) and destination (<code>to</code>) points. Flows commonly arise in origin-destination matrices used in transport studies, but may be any kind of generic flows on graphs. A flow matrix specifies the flow between each pair of origin and destination points, and the <a href="https://atfutures.github.io/dodgr/reference/dodgr_flows_aggregate.html"><code><a href="../reference/dodgr_flows_aggregate.html">dodgr_flows_aggregate()</a></code></a> function aggregates all of these flows throughout a network and assigns a resultant aggregate flow to each edge.</p>
<p>For a set of <code>nf</code> points of origin and <code>nt</code> points of destination, flows are defined by a simple <code>nf</code>-by-<code>nt</code> matrix of values, as in the following code:</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb102-1" data-line-number="1">graph &lt;-<span class="st"> </span><span class="kw"><a href="../reference/weight_streetnet.html">weight_streetnet</a></span> (hampi, <span class="dt">wt_profile =</span> <span class="st">"foot"</span>)</a>
<a class="sourceLine" id="cb102-2" data-line-number="2">from &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/sample.html">sample</a></span> (graph<span class="op">$</span>from_id, <span class="dt">size =</span> <span class="dv">10</span>)</a>
<a class="sourceLine" id="cb102-3" data-line-number="3">to &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/sample.html">sample</a></span> (graph<span class="op">$</span>to_id, <span class="dt">size =</span> <span class="dv">10</span>)</a>
<a class="sourceLine" id="cb102-4" data-line-number="4">flows &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span> (<span class="dv">10</span> <span class="op">*</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span> (<span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span> (from) <span class="op">*</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span> (to)),</a>
<a class="sourceLine" id="cb102-5" data-line-number="5">                 <span class="dt">nrow =</span> <span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span> (from))</a></code></pre></div>
<p>This <code>flows</code> matrix is then submitted to <a href="https://atfutures.github.io/dodgr/reference/dodgr_flows_aggregate.html"><code><a href="../reference/dodgr_flows_aggregate.html">dodgr_flows_aggregate()</a></code></a>, which simply appends an additional column of <code>flows</code> to the submitted <code>graph</code>:</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb103-1" data-line-number="1">graph_f &lt;-<span class="st"> </span><span class="kw"><a href="../reference/dodgr_flows_aggregate.html">dodgr_flows_aggregate</a></span> (graph, <span class="dt">from =</span> from, <span class="dt">to =</span> to, <span class="dt">flows =</span> flows)</a>
<a class="sourceLine" id="cb103-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span> (graph_f)</a></code></pre></div>
<pre><code>##   geom_num edge_id    from_id from_lon from_lat      to_id   to_lon
## 1        1       1  339318500 76.47489 15.34169  339318502 76.47612
## 2        1       2  339318502 76.47612 15.34173  339318500 76.47489
## 3        1       3  339318502 76.47612 15.34173 2398958028 76.47621
## 4        1       4 2398958028 76.47621 15.34174  339318502 76.47612
## 5        1       5 2398958028 76.47621 15.34174 1427116077 76.47628
## 6        1       6 1427116077 76.47628 15.34179 2398958028 76.47621
##     to_lat          d d_weighted      highway   way_id component      time
## 1 15.34173 132.442169  165.55271 unclassified 28565950         1 95.358362
## 2 15.34169 132.442169  165.55271 unclassified 28565950         1 95.358362
## 3 15.34174   8.888670   11.11084 unclassified 28565950         1  6.399842
## 4 15.34173   8.888670   11.11084 unclassified 28565950         1  6.399842
## 5 15.34179   9.326536   11.65817 unclassified 28565950         1  6.715106
## 6 15.34174   9.326536   11.65817 unclassified 28565950         1  6.715106
##   time_weighted flow
## 1    119.197952    0
## 2    119.197952    0
## 3      7.999803    0
## 4      7.999803    0
## 5      8.393882    0
## 6      8.393882    0</code></pre>
<p>Most flows are zero because they have only been calculated between very few points in the graph.</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb105-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span> (graph_f<span class="op">$</span>flow)</a></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##   0.000   0.000   0.000   4.722   0.000  63.158</code></pre>
</div>
<div id="flow-dispersal" class="section level2">
<h2 class="hasAnchor">
<a href="#flow-dispersal" class="anchor"></a>7.2 Flow Dispersal</h2>
<p>The second function, <a href="https://atfutures.github.io/dodgr/reference/dodgr_flows_disperse.html"><code><a href="../reference/dodgr_flows_disperse.html">dodgr_flows_disperse()</a></code></a>, uses only a vector a origin (<code>from</code>) points, and aggregates flows as they disperse throughout the network according to a simple exponential model. In place of the matrix of flows required by <a href="https://atfutures.github.io/dodgr/reference/dodgr_flows_aggregate.html"><code><a href="../reference/dodgr_flows_aggregate.html">dodgr_flows_aggregate()</a></code></a>, dispersal requires an equivalent vector of densities dispersing from all origin (<code>from</code>) points. This is illustrated in the following code, using the same graph as the previous example.</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb107-1" data-line-number="1">dens &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span> (<span class="dv">1</span>, <span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span> (from)) <span class="co"># uniform densities</span></a>
<a class="sourceLine" id="cb107-2" data-line-number="2">graph_f &lt;-<span class="st"> </span><span class="kw"><a href="../reference/dodgr_flows_disperse.html">dodgr_flows_disperse</a></span> (graph, <span class="dt">from =</span> from, <span class="dt">dens =</span> dens)</a>
<a class="sourceLine" id="cb107-3" data-line-number="3"><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span> (graph_f<span class="op">$</span>flow)</a></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
## 0.00000 0.00000 0.01105 0.13141 0.14489 1.55122</code></pre>
</div>
<div id="merging-directed-flows" class="section level2">
<h2 class="hasAnchor">
<a href="#merging-directed-flows" class="anchor"></a>7.3 Merging directed flows</h2>
<p>Note that flows from both <a href="https://atfutures.github.io/dodgr/reference/dodgr_flows_aggregate.html"><code><a href="../reference/dodgr_flows_aggregate.html">dodgr_flows_aggregate()</a></code></a> and <a href="https://atfutures.github.io/dodgr/reference/dodgr_flows_aggregate.html"><code><a href="../reference/dodgr_flows_disperse.html">dodgr_flows_disperse()</a></code></a> are <em>directed</em>, so the flow from ‘A’ to ‘B’ will not necessarily equal the flow from ‘B’ to ‘A’. It is often desirable to aggregate flows in an undirected manner, for example for visualisations where plotting pairs of directed flows between each edge if often not feasible for large graphs. Directed flows can be aggregated to equivalent undirected flows with the <code><a href="../reference/merge_directed_flows.html">merge_directed_flows()</a></code> function:</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb109-1" data-line-number="1">graph_undir &lt;-<span class="st"> </span><span class="kw"><a href="../reference/merge_directed_flows.html">merge_directed_flows</a></span> (graph_f)</a></code></pre></div>
<p>Resultant graphs produced by <a href="https://atfutures.github.io/dodgr/reference/merge_directed_flows.html"><code><a href="../reference/merge_directed_flows.html">merge_directed_flows()</a></code></a> only include those edges having non-zero flows, and so:</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb110-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span> (graph_f); <span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span> (graph_undir) <span class="co"># the latter is much smaller</span></a></code></pre></div>
<pre><code>## [1] 5973</code></pre>
<pre><code>## [1] 2845</code></pre>
<p>The resultant graph can readily be merged with the original graph to regain the original data on vertex coordinates through</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb113-1" data-line-number="1">graph &lt;-<span class="st"> </span>graph [graph_undir<span class="op">$</span>edge_id, ]</a>
<a class="sourceLine" id="cb113-2" data-line-number="2">graph<span class="op">$</span>flow &lt;-<span class="st"> </span>graph_undir<span class="op">$</span>flow</a></code></pre></div>
<p>This graph may then be used to visualise flows with the <a href="https://atfutures.github.io/dodgr/reference/dodgr_flowmap.html"><code><a href="../reference/dodgr_flowmap.html">dodgr_flowmap()</a></code></a> function:</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb114-1" data-line-number="1">graph_f &lt;-<span class="st"> </span>graph_f [graph_f<span class="op">$</span>flow <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, ]</a>
<a class="sourceLine" id="cb114-2" data-line-number="2"><span class="kw"><a href="../reference/dodgr_flowmap.html">dodgr_flowmap</a></span> (graph_f, <span class="dt">linescale =</span> <span class="dv">5</span>)</a></code></pre></div>
<p><img src="hampi-flowmap.png"></p>
</div>
</div>
<div id="bibliography" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#bibliography" class="anchor"></a>Bibliography</h1>
<div id="refs" class="references">
<div id="ref-Csardi2006">
<p>Csardi, Gabor, and Tamas Nepusz. 2006. “The Igraph Software Package for Complex Network Research.” <em>InterJournal</em> Complex Systems: 1695. <a href="http://igraph.org" class="uri">http://igraph.org</a>.</p>
</div>
<div id="ref-Fredman1987">
<p>Fredman, Michael L., and Robert Endre Tarjan. 1987. “Fibonacci Heaps and Their Uses in Improved Network Optimization Algorithms.” <em>J. ACM</em> 34 (3). New York, NY, USA: ACM: 596–615. <a href="https://doi.org/10.1145/28869.28874" class="uri">https://doi.org/10.1145/28869.28874</a>.</p>
</div>
<div id="ref-Johnson1977">
<p>Johnson, Donald B. 1977. “Efficient Algorithms for Shortest Paths in Sparse Networks.” <em>J. ACM</em> 24 (1). New York, NY, USA: ACM: 1–13. <a href="https://doi.org/10.1145/321992.321993" class="uri">https://doi.org/10.1145/321992.321993</a>.</p>
</div>
<div id="ref-Miller1960">
<p>Miller, Rupert G. 1960. “Priority Queues.” <em>The Annals of Mathematical Statistics</em> 31 (1). Institute of Mathematical Statistics: 86–103. <a href="https://www.jstor.org/stable/2237496" class="uri">https://www.jstor.org/stable/2237496</a>.</p>
</div>
<div id="ref-Saunders2004">
<p>Saunders, Shane. 2004. “Improved Shortest Path Algorithms for Nearly Acyclic Graphs.” PhD thesis, Department of Computer Science; Software Engineering, University of Canterbury, New Zealand.</p>
</div>
<div id="ref-Saunders2003">
<p>Saunders, S., and T. Takaoka. 2003. “Improved Shortest Path Algorithms for Nearly Acyclic Graphs.” <em>Theoretical Computer Science</em> 293 (3): 535–56.</p>
</div>
<div id="ref-Takaoka1999">
<p>Takaoka, Tadao. 1999. “Theory of 2-3 Heaps.” In <em>Computing and Combinatorics: 5th Annual International Conference, Cocoon’99 Tokyo, Japan, July 26–28, 1999 Proceedings</em>, edited by Takano Asano, Hideki Imai, D. T. Lee, Shin-ichi Nakano, and Takeshi Tokuyama, 41–50. Springer Berlin Heidelberg. <a href="https://doi.org/10.1007/3-540-48686-0_4" class="uri">https://doi.org/10.1007/3-540-48686-0_4</a>.</p>
</div>
<div id="ref-Takaoka2000">
<p>———. 2000. “Theory of Trinomial Heaps.” In <em>Computing and Combinatorics: 6th Annual International Conference, Cocoon 2000 Sydney, Australia, July 26–28, 2000 Proceedings</em>, edited by Ding-Zhu Du, Peter Eades, Vladimir Estivill-Castro, Xuemin Lin, and Arun Sharma, 362–72. Springer Berlin Heidelberg. <a href="https://doi.org/10.1007/3-540-44968-X_36" class="uri">https://doi.org/10.1007/3-540-44968-X_36</a>.</p>
</div>
<div id="ref-Tarjan1983">
<p>Tarjan, R. 1983. <em>Data Structures and Network Algorithms</em>. Society for Industrial; Applied Mathematics. <a href="https://doi.org/10.1137/1.9781611970265" class="uri">https://doi.org/10.1137/1.9781611970265</a>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#background-directed-graphs">1 Background: Directed Graphs</a><ul class="nav nav-pills nav-stacked">
<li><a href="#dual-weighted-directed-graphs">1.1 Dual-Weighted Directed Graphs</a></li>
      </ul>
</li>
      <li><a href="#introduction-to-dodgr">2 Introduction to <code>dodgr</code></a></li>
      <li>
<a href="#graphs-and-street-networks">3 Graphs and Street Networks</a><ul class="nav nav-pills nav-stacked">
<li><a href="#graph-components">3.1 Graph Components</a></li>
      <li><a href="#weighting-profiles">3.2 Weighting Profiles</a></li>
      <li><a href="#random-sub-graphs">3.3 Random Sub-Graphs</a></li>
      </ul>
</li>
      <li>
<a href="#distance-matrices-dodgr_dists">4 Distance Matrices: <code>dodgr_dists()</code></a><ul class="nav nav-pills nav-stacked">
<li><a href="#aligning-routing-points-to-graphs">4.1 Aligning Routing Points to Graphs</a></li>
      <li><a href="#shortest-path-calculations-priority-queues">4.2 Shortest Path Calculations: Priority Queues</a></li>
      </ul>
</li>
      <li>
<a href="#graph-contraction">5 Graph Contraction</a><ul class="nav nav-pills nav-stacked">
<li><a href="#routing-on-contracted-graphs">5.1 Routing on Contracted Graphs</a></li>
      </ul>
</li>
      <li><a href="#shortest-paths">6 Shortest Paths</a></li>
      <li>
<a href="#aggregated-flows">7 Aggregated Flows</a><ul class="nav nav-pills nav-stacked">
<li><a href="#direct-aggregation">7.1 Direct Aggregation</a></li>
      <li><a href="#flow-dispersal">7.2 Flow Dispersal</a></li>
      <li><a href="#merging-directed-flows">7.3 Merging directed flows</a></li>
      </ul>
</li>
      <li><a href="#bibliography">Bibliography</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Mark Padgham, Andreas Petutschnig.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
